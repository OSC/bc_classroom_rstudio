<%-
  groups = OodSupport::User.new.groups.sort_by(&:id).tap do |groups|
    groups.unshift(groups.delete(OodSupport::Process.group))
  end.map(&:name).grep(/^P./)

  classrooms = OodAppkit.clusters.each_with_object({}) do |cluster, hash|
    if cluster.kubernetes?
      hash.merge!(cluster.custom_config[:classrooms].to_h)
    end
  end.select do |k,v|
    k.start_with?('rstudio') && groups.include?(v)
  end.map do |k,v|
    tokens = k.gsub('rstudio/', '').split('/')

    {
      name: tokens[0].nil? ? 'unknown' : tokens[0],
      size: tokens[1].nil? ? 1 : tokens[1].to_i,
      time: tokens[2].nil? ? 1 : tokens[2].to_i,
      account: v,
    }
  end
-%>
---
cluster:
  - "kubernetes"
  - "kubernetes-test"
  - "kubernetes-dev"
form:
  - classroom
  - account
  - size
  - time
attributes:
  account:
    widget: "hidden_field"
  time:
    widget: "select"
    options:
      - [
          "1.5 hours", "1.5",
        ]
      - [
          "3 hours", "3",
          <%- classrooms.each do |cr| %>
            <%- unless cr[:time].to_i >= 3 %>
            data-option-for-classroom-<%= cr[:name].to_s.gsub('_', '-') %>: false,
            <%- end %>
          <%- end %>
        ]
      - [
          "6 hours", "6",
          <%- classrooms.each do |cr| %>
            <%- unless cr[:time].to_i >= 6 %>
            data-option-for-classroom-<%= cr[:name].to_s.gsub('_', '-') %>: false,
            <%- end %>
          <%- end %>
        ]
    help: Instructors can request longer times.
  size:
    widget: "select"
    options:
      - [
          "small", "small",
        ]
      - [
          "medium", "medium",
          <%- classrooms.each do |cr| %>
            <%- unless cr[:size].to_i >= 1 %>
            data-option-for-classroom-<%= cr[:name].to_s.gsub('_', '-') %>: false,
            <%- end %>
          <%- end %>
        ]
      - [
          "large", "large",
          <%- classrooms.each do |cr| %>
            <%- unless cr[:size].to_i >= 2 %>
            data-option-for-classroom-<%= cr[:name].to_s.gsub('_', '-') %>: false,
            <%- end %>
          <%- end %>
        ]
      - [
          "exra-large", "exra-large",
          <%- classrooms.each do |cr| %>
            <%- unless cr[:size].to_i >= 3 %>
            data-option-for-classroom-<%= cr[:name].to_s.gsub('_', '-') %>: false,
            <%- end %>
          <%- end %>
        ]
    help: |
      Larger sizes may not be applicable for your classroom. Instructors can request larger
      sizes.

      * **small** - less than 1 core & 2 GB of memory.
      * **medium** - 2 cores & 8 GB of memory.
      * **large** - 4 cores & 16 GB of memory.
      * **extra-large** - 8 cores & 32 GB of memory.
  classroom:
  <%- if classrooms.size >= 1 -%>
    widget: select
    options:
      <%- classrooms.each do |cr| %>
      - [
        "<%= cr[:name].gsub('_', ' ') %>", "<%= cr[:name] %>",
        data-set-account: "<%= cr[:account] %>",
        ]
      <%- end %>
  <%- else -%>
    widget: 'hidden_field'
    value: 'no_classroom'
  <%- end -%>
