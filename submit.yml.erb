<%
  mounts = {
    'home'    => OodSupport::User.new.home,
    'support' => OodSupport::User.new('support').home,
    'project' => '/fs/project',
    'scratch' => '/fs/scratch',
    'ess'     => '/fs/ess',
  }
-%>
---
script:
  accounting_id: "<%= account %>"
  wall_time: "<%= bc_num_hours.to_i * 3600 %>"
  native:
    container:
      name: "jupyter"
      image: "docker-registry.osc.edu/ondemand/ondemand-base-rhel7:0.3.1"
      image_pull_policy: "IfNotPresent"
      command: ["/bin/bash","-l","<%= staged_root %>/job_script_content.sh"]
      restart_policy: 'OnFailure'
      env:
        KUBECONFIG: "/dev/null"
      port: "8080"
      cpu: "<%= num_cores %>"
      memory: "<%= num_cores.to_i * 4 %>Gi"
    mounts:
    <%- mounts.each_pair do |name, mount| -%>
      - type: host
        name: <%= name %>
        host_type: Directory
        path: <%= mount %>
        destination_path: <%= mount %>
    <%- end -%>
      - type: host
        name: munge-socket
        host_type: Socket
        path: /var/run/munge/munge.socket.2
        destination_path: /var/run/munge/munge.socket.2
      - type: host
        name: slurm-conf
        host_type: Directory
        path: /etc/slurm
        destination_path: /etc/slurm
      - type: host
        name: sssd-pipes
        host_type: Directory
        path: /var/lib/sss/pipes
        destination_path: /var/lib/sss/pipes
      - type: host
        name: sssd-conf
        host_type: Directory
        path: /etc/sssd
        destination_path: /etc/sssd
      - type: host
        name: nsswitch
        host_type: File
        path: /etc/nsswitch.conf
        destination_path: /etc/nsswitch.conf
      - type: host
        name: lmod-init
        host_type: File
        path: /apps/pitzer/lmod/lmod.sh
        destination_path: /etc/profile.d/lmod.sh
      - type: host
        name: intel
        host_type: Directory
        path: /nfsroot/pitzer/opt/intel
        destination_path: /opt/intel
      - type: host
        name: apps
        host_type: Directory
        path: /apps/pitzer
        destination_path: /apps
